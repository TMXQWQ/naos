#! /bin/sh

name=xorg-server
version=21.1.16
revision=1
tarball_url="https://www.x.org/releases/individual/xserver/xorg-server-${version}.tar.xz"
tarball_blake2b="90a2aded6ab324dbaed976461062b7dccbc09466229cf8da8aaf0e9049144a8a5109ad35b1ee994451cdc5c33be45c6cb1f5a32ab6e8c021ca71f6ef180400f8"
hostdeps="gcc pkg-config"
deps="core-libs dbus xorg-util-macros xorg-proto xcb-proto xtrans libtirpc libdrm libpciaccess libxinerama libxcvt libxshmfence libx11 libxaw libxxf86vm libxkbfile libxmu libxfont2 libepoxy libxi libxv libxdamage libxrender libxrandr libxcb libxfixes libxext nettle mesa xorg-font-util xorg-xkbcomp xkeyboard-config pixman"

configure() {
    meson_configure \
        -Dglamor=true \
        -Dsystemd_logind=true \
        -Dxkb_dir=${prefix}/share/X11/xkb \
        -Dxkb_output_dir=/var/lib/xkb \
        -Dxkb_bin_dir=${prefix}/bin \
        -Ddefault_font_path=${prefix}/share/fonts/X11/misc

    sed -i 's|/sysroot||' include/dix-config.h
}

build() {
    meson compile -j${parallelism}
}

package() {
    DESTDIR="${dest_dir}" meson install --no-rebuild

    post_package_strip
}
